package org.benf.cfr_client_example;

import org.benf.cfr.reader.api.CfrDriver;
import org.benf.cfr.reader.api.ClassFileSource;
import org.benf.cfr.reader.bytecode.analysis.parse.utils.Pair;

import java.io.FileNotFoundException;
import java.io.IOException;
import java.util.Collection;
import java.util.Collections;

public class WithSource {
    public static void main(String ... args) {

        class DataSource implements ClassFileSource {
            @Override
            public void informAnalysisRelativePathDetail(String usePath, String classFilePath) {
            }

            @Override
            public Collection<String> addJar(String jarPath) {
                throw new UnsupportedOperationException();
            }

            @Override
            public String getPossiblyRenamedPath(String path) {
                return path;
            }

            @Override
            public Pair<byte[], String> getClassFileContent(String path) throws IOException {
                if (!path.equals("Sml.class")) throw new FileNotFoundException("Can't find " + path);
                byte data[] = {
                        (byte)0xca,(byte)0xfe,(byte)0xba,(byte)0xbe,0x00,0x00,0x00,0x34,0x00,0x1f,0x0a,0x00,0x05,0x00,0x13,0x09
                        ,0x00,0x14,0x00,0x15,0x0a,0x00,0x16,0x00,0x17,0x07,0x00,0x18,0x07,0x00,0x19,0x01
                        ,0x00,0x06,0x3c,0x69,0x6e,0x69,0x74,0x3e,0x01,0x00,0x03,0x28,0x29,0x56,0x01,0x00
                        ,0x04,0x43,0x6f,0x64,0x65,0x01,0x00,0x0f,0x4c,0x69,0x6e,0x65,0x4e,0x75,0x6d,0x62
                        ,0x65,0x72,0x54,0x61,0x62,0x6c,0x65,0x01,0x00,0x12,0x4c,0x6f,0x63,0x61,0x6c,0x56
                        ,0x61,0x72,0x69,0x61,0x62,0x6c,0x65,0x54,0x61,0x62,0x6c,0x65,0x01,0x00,0x04,0x74
                        ,0x68,0x69,0x73,0x01,0x00,0x1a,0x4c,0x6f,0x72,0x67,0x2f,0x62,0x65,0x6e,0x66,0x2f
                        ,0x63,0x66,0x72,0x5f,0x65,0x78,0x61,0x6d,0x70,0x6c,0x65,0x2f,0x53,0x6d,0x6c,0x3b
                        ,0x01,0x00,0x03,0x66,0x6f,0x6f,0x01,0x00,0x04,0x28,0x49,0x29,0x56,0x01,0x00,0x01
                        ,0x78,0x01,0x00,0x01,0x49,0x01,0x00,0x0a,0x53,0x6f,0x75,0x72,0x63,0x65,0x46,0x69
                        ,0x6c,0x65,0x01,0x00,0x08,0x53,0x6d,0x6c,0x2e,0x6a,0x61,0x76,0x61,0x0c,0x00,0x06
                        ,0x00,0x07,0x07,0x00,0x1a,0x0c,0x00,0x1b,0x00,0x1c,0x07,0x00,0x1d,0x0c,0x00,0x1e
                        ,0x00,0x0e,0x01,0x00,0x18,0x6f,0x72,0x67,0x2f,0x62,0x65,0x6e,0x66,0x2f,0x63,0x66
                        ,0x72,0x5f,0x65,0x78,0x61,0x6d,0x70,0x6c,0x65,0x2f,0x53,0x6d,0x6c,0x01,0x00,0x10
                        ,0x6a,0x61,0x76,0x61,0x2f,0x6c,0x61,0x6e,0x67,0x2f,0x4f,0x62,0x6a,0x65,0x63,0x74
                        ,0x01,0x00,0x10,0x6a,0x61,0x76,0x61,0x2f,0x6c,0x61,0x6e,0x67,0x2f,0x53,0x79,0x73
                        ,0x74,0x65,0x6d,0x01,0x00,0x03,0x6f,0x75,0x74,0x01,0x00,0x15,0x4c,0x6a,0x61,0x76
                        ,0x61,0x2f,0x69,0x6f,0x2f,0x50,0x72,0x69,0x6e,0x74,0x53,0x74,0x72,0x65,0x61,0x6d
                        ,0x3b,0x01,0x00,0x13,0x6a,0x61,0x76,0x61,0x2f,0x69,0x6f,0x2f,0x50,0x72,0x69,0x6e
                        ,0x74,0x53,0x74,0x72,0x65,0x61,0x6d,0x01,0x00,0x05,0x70,0x72,0x69,0x6e,0x74,0x00
                        ,0x21,0x00,0x04,0x00,0x05,0x00,0x00,0x00,0x00,0x00,0x02,0x00,0x01,0x00,0x06,0x00
                        ,0x07,0x00,0x01,0x00,0x08,0x00,0x00,0x00,0x2f,0x00,0x01,0x00,0x01,0x00,0x00,0x00
                        ,0x05,0x2a,(byte)0xb7,0x00,0x01,(byte)0xb1,0x00,0x00,0x00,0x02,0x00,0x09,0x00,0x00,0x00,0x06
                        ,0x00,0x01,0x00,0x00,0x00,0x03,0x00,0x0a,0x00,0x00,0x00,0x0c,0x00,0x01,0x00,0x00
                        ,0x00,0x05,0x00,0x0b,0x00,0x0c,0x00,0x00,0x00,0x00,0x00,0x0d,0x00,0x0e,0x00,0x01
                        ,0x00,0x08,0x00,0x00,0x00,0x42,0x00,0x03,0x00,0x02,0x00,0x00,0x00,0x0a,(byte)0xb2,0x00
                        ,0x02,0x1b,0x04,0x60,(byte)0xb6,0x00,0x03,(byte)0xb1,0x00,0x00,0x00,0x02,0x00,0x09,0x00,0x00
                        ,0x00,0x0a,0x00,0x02,0x00,0x00,0x00,0x05,0x00,0x09,0x00,0x06,0x00,0x0a,0x00,0x00
                        ,0x00,0x16,0x00,0x02,0x00,0x00,0x00,0x0a,0x00,0x0b,0x00,0x0c,0x00,0x00,0x00,0x00
                        ,0x00,0x0a,0x00,0x0f,0x00,0x10,0x00,0x01,0x00,0x01,0x00,0x11,0x00,0x00,0x00,0x02
                        ,0x00,0x12 };
                return Pair.make(data, "Sml.class");
            }
        }

        var source = new DataSource();
        var driver = new CfrDriver.Builder().withClassFileSource(source).build();
        driver.analyse(Collections.singletonList("Sml.class"));
    }
}
